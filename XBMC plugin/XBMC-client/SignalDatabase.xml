<?xml version="1.0" encoding="UTF-8"?>

<!-- TODO: fix XSLT (with a image over the protocol) -->

<IBUS>

	<!-- IBUS Communication protocol definition -->
	<COM-settings>
		<BaudRate>9600</BaudRate>
		<DatBits>8</DatBits>
		<Parity>Even</Parity>
		<StopBits>1</StopBits>
		<Handshake>none</Handshake>
	</COM-settings>

	<!-- IBUS Message definition -->
	<MESSAGE>
	
		<!-- Source-ID and destination-ID description -->
		<DeviceCodes>
			<device id="0x00" ref="IBUS_DEV_GM">Body Module</device>
			<device id="0x18" ref="IBUS_DEV_CDC">CD Changer</device>
			<device id="0x28" ref="IBUS_DEV_FUH">Radio controlled clock</device>
			<device id="0x30" ref="IBUS_DEV_CCM">Check control module</device>
			<device id="0x3B" ref="IBUS_DEV_GT">Graphics driver (in navigation system)</device>
			<device id="0x3F" ref="IBUS_DEV_DIA">Diagnostic</device>
			<device id="0x40" ref="IBUS_DEV_FBZV">Remote control central locking</device>
			<device id="0x43" ref="IBUS_DEV_GTF">Graphics driver for rear screen (in navigation system)</device>
			<device id="0x44" ref="IBUS_DEV_EWS">Immobiliser</device>
			<device id="0x46" ref="IBUS_DEV_CID">Central information display (flip-up LCD screen)</device>
			<device id="0x50" ref="IBUS_DEV_MFL">Multi function steering wheel</device>
			<device id="0x51" ref="IBUS_DEV_MM">Mirror memory</device>
			<device id="0x5B" ref="IBUS_DEV_IHK">Integrated heating and air conditioning</device>
			<device id="0x60" ref="IBUS_DEV_PDC">Park distance control</device>
			<device id="0x67" ref="IBUS_DEV_ONL">unknown</device>
			<device id="0x68" ref="IBUS_DEV_RAD">Radio</device>
			<device id="0x6A" ref="IBUS_DEV_DSP">Digital signal processing audio amplifier (DSP)</device>
			<device id="0x72" ref="IBUS_DEV_SM1">Seat memory</device>
			<device id="0x76" ref="IBUS_DEV_CDCD">CD changer, DIN size.</device>
			<device id="0x7F" ref="IBUS_DEV_NAVE">Navigation (Europe)</device>
			<device id="0x80" ref="IBUS_DEV_IKE">Instrument cluster electronics</device>
			<device id="0x9B" ref="IBUS_DEV_MM1">Mirror memory</device>
			<device id="0x9C" ref="IBUS_DEV_MM2">Mirror memory</device>
			<device id="0xA0" ref="IBUS_DEV_FMID">Rear multi-info-display</device>
			<device id="0xA4" ref="IBUS_DEV_ABM">Air bag module</device>
			<device id="0xA8" ref="IBUS_DEV_KAM">unknown</device>
			<device id="0xAC" ref="IBUS_DEV_ASP">unknown</device>
			<device id="0xB0" ref="IBUS_DEV_SES">Speed recognition system</device>
			<device id="0xBB" ref="IBUS_DEV_NAVJ">Navigation (Japan)</device>
			<device id="0xBF" ref="IBUS_DEV_GLO">Global, broadcast address</device>
			<device id="0xC0" ref="IBUS_DEV_MID">Multi-info display</device>
			<device id="0xC8" ref="IBUS_DEV_TEL">Telephone</device>
			<device id="0xD0" ref="IBUS_DEV_LCM">Light control module</device>
			<device id="0xDA" ref="IBUS_DEV_SM2">Seat memory</device>
			<device id="0xE0" ref="IBUS_DEV_IRIS">Integrated radio information system</device>
			<device id="0xE7" ref="IBUS_DEV_ANZV">Front display</device>
			<device id="0xE8" ref="IBUS_DEV_ISP">unknown</device>
			<device id="0xED" ref="IBUS_DEV_TV">Television</device>
			<device id="0xF0" ref="IBUS_DEV_BMBT">On-board monitor operating part</device>
			<device id="0xF5" ref="IBUS_DEV_CSU">unknown</device>
			<device id="0xFF" ref="IBUS_DEV_LOC">Local</device>
		</DeviceCodes>
		
		<!-- special messages for polling... (only 2 bytes long) -->
		<Polling>
			<byte id="0x01" name="IBUS_byte_DEV_POLL">Poll any device</byte>
			<byte id="0x02" name="IBUS_byte_DEV_READY">Answer to poll message</byte>
		</Polling>

		<reference>
		
		</reference>
		
		<MessageData>
		
			<!-- types of data (device-ID is the sender of the message) -->

			<!-- Message descriptions reference list (first byte in "data")
			TODO: reference to sender device.. type in which byte order? ex. 3:rd byte? -->
			
			<DataTypes position="1">
				<byte device-ref="" id="0x11" name="IBUS_MSG_IGN_STATUS">Ignition key status</byte>
				<byte reference="" id="0x13" name="IBUS_MSG_IKE_STATE">IKE informs about its state</byte>
				<byte reference="" id="0x72" name="IBUS_MSG_REMOTE_KEY">Remote key button action</byte>
				<byte device-id="" id="0x48" name="IBUS_MSG_BMBT_BUTTON">Board monitor button action</byte>
				<byte source-id="" id="0x32" name="IBUS_MSG_VOLUME_CTRL">Volume adjustment (wheel button and BMBT button)</byte>
				<byte source-id="" id="0x3B" name="IBUS_MSG_MFL_BUTTON">Steering wheel button action</byte>		
			</DataTypes>
			
			<!-- Volume control for Steering wheel buttons -and turn knob -->	
			
			<data type="IBUS_MSG_VOLUME_CTRL">
				<button button-id="" name="volume-up">
					<byte id="0x11" state="press"/>
					<byte id="0x31" state="release"/>
				</button>
				
				<button button-id="" name="volume-down">
					<byte id="0x10" state="press"/>
					<byte id="0x30" state="release"/>
				</button>
			</data>
			
			<!-- Steering wheel buttons -->
			
			<data type="IBUS_MSG_MFL_BUTTON">

                <!-- TODO: name "data" to "chunk" -or "byte"? -->

				<button button-id="" name="next">
					<byte id="0x01" state="press"/>
					<byte id="0x21" state="release"/>
				</button>
				
				<button button-id="" name="previous">
					<byte id="0x08" state="press"/>
					<byte id="0x28" state="release"/>
				</button>
				
				<button button-id="" name="RT">
					<byte id="0x80" state="press"/>
					<!--<byte id="" state="release"/>-->
				</button>
				
				<button button-id="" name="voice">
					<data id="0x80" state="press"/>
					<data id="0x90" state="hold"/>
					<data id="0xA0" state="release"/>
				</button>
			</data>
		
			<!-- Board monitor buttons -->	
			
			<data type="IBUS_MSG_BMBT_BUTTON">
			
				<!-- Board monitor buttons, left side -->
				
				<!-- special: one byte more. how to handle?
				<button button-id="" name="info">
					<byte id="00" state="press"/>
					<byte id="40" state="hold"/>
					<byte id="80" state="release"/>
				</button>
				-->
				
				<!-- casette-cd-radio changer -->
				<button button-id="" name="state">
					<byte id="0x" state="press"/>
					<byte id="0x" state="hold"/>
					<byte id="0x" state="release"/>
				</button>
				
				<button button-id="" name="FM">
					<byte id="0x31" state="press"/>
					<byte id="0x71" state="hold"/>
					<byte id="0xB1" state="release"/>
				</button>
				
				<button button-id="" name="AM">
					<byte id="0x21" state="press"/>
					<byte id="0x61" state="hold"/>
					<byte id="0xA1" state="release"/>
				</button>
				
				<button button-id="" name="mode">
					<byte id="0x23" state="press"/>
					<byte id="0x63" state="hold"/>
					<byte id="0xA3" state="release"/>
				</button>
				
				<button button-id="" name="1">
					<byte id="0x11" state="press"/>
					<byte id="0x51" state="hold"/>
					<byte id="0x91" state="release"/>
				</button>
				
				<button button-id="" name="4">
					<byte id="0x02" state="press"/>
					<byte id="0x42" state="hold"/>
					<byte id="0x82" state="release"/>
				</button>
				
				<button button-id="" name="2">
					<byte id="0x01" state="press"/>
					<byte id="0x41" state="hold"/>
					<byte id="0x81" state="release"/>
				</button>
				
				<button button-id="" name="5">
					<byte id="0x13" state="press"/>
					<byte id="0x52" state="hold"/>
					<byte id="0x93" state="release"/>
				</button>
				
				<button button-id="" name="3">
					<byte id="0x12" state="press"/>
					<byte id="0x52" state="hold"/>
					<byte id="0x92" state="release"/>
				</button>
				
				<button button-id="" name="6">
					<byte id="0x03" state="press"/>
					<byte id="0x43" state="hold"/>
					<byte id="0x83" state="release"/>
				</button>
				
				<button button-id="" name="left-knob">
					<byte id="0x06" state="press"/>
					<byte id="0x46" state="hold"/>
					<byte id="0x86" state="release"/>
				</button>

				<!-- Board monitor buttons, right side -->
				
				<!-- button-id refers to the button mapped in the image (presented with XSLT sheet) -->

				<button button-id="" name="eject">
					<byte id="0x24" state="press"/>
					<byte id="0x64" state="hold"/>
					<byte id="0xA4" state="release"/>
				</button>
				
				<button button-id="" name="phone">
					<byte id="0x08" state="press"/>
					<byte id="0x48" state="hold"/>
					<byte id="0x88" state="release"/>
				</button>	

				<button button-id="" name="previous">
					<byte id="0x10" state="press"/>
					<byte id="0x50" state="hold"/>
					<byte id="0x90" state="release"/>
				</button>
				
				<button button-id="" name="next">
					<byte id="0x00" state="press"/>
					<byte id="0x40" state="hold"/>
					<byte id="0x80" state="release"/>
				</button>

				<button button-id="" name="reverse-tape">
					<byte id="0x14" state="press"/>
					<byte id="0x54" state="hold"/>
					<byte id="0x94" state="release"/>
				</button>

				<button button-id="" name="clock">
					<byte id="0x07" state="press"/>
					<byte id="0x47" state="hold"/>
					<byte id="0x87" state="release"/>
				</button>

				<button button-id="" name="tone">
					<byte id="0x04" state="press"/>
					<byte id="0x44" state="hold"/>
					<byte id="0x84" state="release"/>
				</button>
				
				<!--  alternative structure for above: -->
				<button button-id="" name="tone">
					<state byte-id="0x04" id="press"/>
					<state byte-id="0x44" id="hold"/>
					<state byte-id="0x84" id="release"/>
				</button>
	<!-- 
	another identifier: 47
			
				<button button-id="" name="select">
					<byte id="0x" state="press"/>
					<byte id="0x" state="hold"/>
					<byte id="0x" state="release"/>
				</button>
	-->
				<button button-id="" name="menu">
					<byte id="0x34" state="press"/>
					<byte id="0x74" state="hold"/>
					<byte id="0xB4" state="release"/>
				</button>
				
	<!-- 
	another identifier: 49

				<button button-id="" name="right-knob">
					<byte id="0x01" state="right-turn"/>
					<byte id="0x81" state="left-turn"/>
				</button>
	-->
				<button button-id="" name="right-knob">
					<byte id="0x05" state="press"/>
					<byte id="0x45" state="hold"/>
					<byte id="0x85" state="release"/>
				</button>
				
			
			</data>
		</MessageData>

		<PDU>
			<msg name="right-knob.press">
				<byte pos="1" ref="IBUS_MSG_BMBT_BUTTON"/>
				<byte pos="2" ref="">0x05</byte>
			</msg>
		</PDU>
		
	</MESSAGE>
</IBUS>